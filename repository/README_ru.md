# Criage Repository Server

–°–µ—Ä–≤–µ—Ä —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞–º–∏ Criage.

[üá¨üáß English Version](README.md) | üá∑üá∫ –†—É—Å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì¶ **–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
- üîç **–ü–æ–∏—Å–∫ –ø–∞–∫–µ—Ç–æ–≤** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π –∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–æ–≤
- üåê **REST API** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- üöÄ **–í–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –ø—Ä–æ—Å—Ç–æ–π –≤–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–∫–µ—Ç–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.21 –∏–ª–∏ –≤—ã—à–µ
- Git

### –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd criage/repository

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
go mod tidy

# –°–æ–±–∏—Ä–∞–µ–º —Å–µ—Ä–≤–µ—Ä
go build -o criage-repository

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
./criage-repository

# –ò–ª–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
./criage-repository -config /path/to/config.json
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8080`

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `config.json`:

```json
{
  "port": 8080,
  "storage_path": "./packages",
  "index_path": "./index.json",
  "upload_token": "your-secret-token",
  "max_file_size": 104857600,
  "allowed_formats": [
    "tar.zst",
    "tar.lz4", 
    "tar.xz",
    "tar.gz",
    "zip"
  ],
  "enable_cors": true,
  "log_level": "info"
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- `port` - –ø–æ—Ä—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8080)
- `storage_path` - –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –ø–∞–∫–µ—Ç–∞–º–∏ (./packages)
- `index_path` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–Ω–¥–µ–∫—Å–∞ (./index.json)
- `upload_token` - —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
- `max_file_size` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö
- `allowed_formats` - —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∞—Ä—Ö–∏–≤–æ–≤
- `enable_cors` - –≤–∫–ª—é—á–∏—Ç—å CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
- `log_level` - —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## API Endpoints

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

```
GET /api/v1/
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã.

### –°–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤

```
GET /api/v1/packages?page=1&limit=20
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–∫–µ—Ç–µ

```
GET /api/v1/packages/{name}
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–∫–µ—Ç–µ —Å–æ –≤—Å–µ–º–∏ –≤–µ—Ä—Å–∏—è–º–∏.

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏

```
GET /api/v1/packages/{name}/{version}
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –ø–∞–∫–µ—Ç–∞.

### –ü–æ–∏—Å–∫ –ø–∞–∫–µ—Ç–æ–≤

```
GET /api/v1/search?q={query}&limit=20
```

–í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–∏—Å–∫ –ø–∞–∫–µ—Ç–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é, –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º.

### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞

```
GET /api/v1/download/{name}/{version}/{filename}
```

–°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª –ø–∞–∫–µ—Ç–∞. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π.

### –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–∫–µ—Ç–∞

```
POST /api/v1/upload
Headers: Authorization: Bearer {token}
Content-Type: multipart/form-data
```

–ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–π –ø–∞–∫–µ—Ç. –¢—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```
GET /api/v1/stats
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π, —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –ª–∏—Ü–µ–Ω–∑–∏—è–º –∏ –∞–≤—Ç–æ—Ä–∞–º.

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞

```
POST /api/v1/refresh
Headers: Authorization: Bearer {token}
```

–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–µ–∫—Å –ø–∞–∫–µ—Ç–æ–≤.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–∫–µ—Ç–∞ —á–µ—Ä–µ–∑ curl

```bash
curl -X POST \
  -H "Authorization: Bearer your-secret-token" \
  -F "package=@test-package-1.0.0.tar.zst" \
  http://localhost:8080/api/v1/upload
```

### –ü–æ–∏—Å–∫ –ø–∞–∫–µ—Ç–æ–≤

```bash
curl "http://localhost:8080/api/v1/search?q=test"
```

### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞

```bash
curl -O "http://localhost:8080/api/v1/download/test-package/1.0.0/test-package-1.0.0.tar.zst"
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å criage

–î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
criage publish --registry http://localhost:8080 --token your-secret-token
```

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```bash
criage config set registry http://localhost:8080
criage install package-name
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ò–Ω–¥–µ–∫—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JSON –∏–Ω–¥–µ–∫—Å –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ `index.json`:

```json
{
  "last_updated": "2024-01-15T10:30:45Z",
  "total_packages": 25,
  "packages": {
    "package-name": {
      "name": "package-name",
      "description": "Package description",
      "author": "Author Name",
      "license": "MIT",
      "versions": [
        {
          "version": "1.0.0",
          "files": [
            {
              "os": "linux",
              "arch": "amd64",
              "format": "tar.zst",
              "filename": "package-1.0.0-linux-amd64.tar.zst",
              "size": 1024,
              "checksum": "sha256:..."
            }
          ]
        }
      ]
    }
  }
}
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ criage:

- –ú–∞–Ω–∏—Ñ–µ—Å—Ç –ø–∞–∫–µ—Ç–∞ (`criage.yaml`)
- –ú–∞–Ω–∏—Ñ–µ—Å—Ç —Å–±–æ—Ä–∫–∏ (`build.json`)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∂–∞—Ç–∏–∏
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker

```dockerfile
FROM golang:1.21-alpine AS builder

WORKDIR /app
COPY . .
RUN go mod tidy
RUN go build -o criage-repository

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/

COPY --from=builder /app/criage-repository .
COPY --from=builder /app/web ./web/

EXPOSE 8080
CMD ["./criage-repository"]
```

### Systemd Service

```ini
[Unit]
Description=Criage Repository Server
After=network.target

[Service]
Type=simple
User=criage
WorkingDirectory=/opt/criage-repository
ExecStart=/opt/criage-repository/criage-repository -config /etc/criage/config.json
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–µ—Ä–≤–µ—Ä –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–∞–∫–µ—Ç–∞–º–∏. –õ–æ–≥–∏ –≤–∫–ª—é—á–∞—é—Ç:

- HTTP –∑–∞–ø—Ä–æ—Å—ã —Å –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ó–∞–≥—Ä—É–∑–∫—É –Ω–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
- –û—à–∏–±–∫–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏–π

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Bearer —Ç–æ–∫–µ–Ω—ã
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤
- CORS –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≤–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTTP Keep-Alive

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª LICENSE –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
